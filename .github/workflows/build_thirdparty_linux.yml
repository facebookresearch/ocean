# This workflow builds and tests Ocean on Linux (release, static)
# Based on : https://github.com/actions/starter-workflows/blob/main/ci/cmake-single-platform.yml
name: Build third-party libraries of Ocean (Linux, static, release)

on:
  push:
    paths:
      - build/cmake/**

env:
  OCEAN_BUILD_TYPE: release
  OCEAN_LINK_TYPE: static
  OCEAN_BUILD_PATH: ocean_build

  OCEAN_INSTALL_PATH: ocean_install

  OCEAN_THIRDPARTY_ARCHIVE: ocean_thirdparty.zip

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get upgrade
          sudo apt-get install -o Acquire::Retries=5 \
            cmake git ninja-build zip

      - name: Build third-party libraries
        run: |
          ${{ github.workspace }}/build/cmake/build_thirdparty_linuxunix.sh \
            -i ${{ env.OCEAN_INSTALL_PATH }} \
            -b ${{ env.OCEAN_BUILD_PATH }} \
            -c ${{ env.OCEAN_BUILD_TYPE }} \
            -l ${{ env.OCEAN_LINK_TYPE }} \
            -a ${{ env.OCEAN_THIRDPARTY_ARCHIVE }}

      - name: Upload archive containing third-party libraries
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.OCEAN_THIRDPARTY_ARCHIVE }}
          path: ${{ env.OCEAN_THIRDPARTY_ARCHIVE }}
